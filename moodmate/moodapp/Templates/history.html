{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mood History</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="text-center text-primary mb-4"> Mood History & Trends</h2>

      <!-- Chart Section -->
      <div class="card shadow p-4 mb-4">
        <canvas id="moodChart"></canvas>
      </div>

      <!-- Table Section -->
      <div class="card shadow p-4">
        <h4 class="text-secondary mb-3">Past Results</h4>
        <table class="table table-bordered table-striped text-center">
          <thead class="table-primary">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Mood</th>
              <th>Score</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for mood in moods %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ mood.name }}</td>
              <td>{{ mood.mood }}</td>
              <td>{{ mood.score }}</td>
              <td>{{ mood.date|date:"Y-m-d H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5">No records yet.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="text-center mt-4">
        <a href="{% url 'moodapp:home' %}" class="btn btn-outline-primary"
          > Back to Home</a
        >
      </div>
    </div>

    <!-- Chart.js Script -->
    <script>
      const ctx = document.getElementById('moodChart').getContext('2d');
      const moodChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: {{ labels|safe }},
          datasets: [{
            label: 'Mood Count',
            data: {{ data|safe }},
            backgroundColor: ['#4CAF50', '#FFC107', '#2196F3', '#E91E63'],
            borderColor: '#000',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    </script>
  </body>
</html>
